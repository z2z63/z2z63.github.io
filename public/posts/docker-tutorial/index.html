

<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>docker 使用方法 - Virtualfutre&#39;s Blog</title><meta name="Description" content=""><meta property="og:title" content="docker 使用方法" />
<meta property="og:description" content="这篇文章是完成docker的get started guide后的总结，见https://docs.docker.com/get-started/" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/posts/docker-tutorial/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-16T18:21:19+00:00" />
<meta property="article:modified_time" content="2023-12-16T18:21:19+00:00" />

<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="docker 使用方法"/>
<meta name="twitter:description" content="这篇文章是完成docker的get started guide后的总结，见https://docs.docker.com/get-started/"/>
<meta name="application-name" content="Virtualfutre&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="Virtualfutre&#39;s Blog">

<meta name="theme-color" content="#f8f8f8"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="canonical" href="http://example.org/posts/docker-tutorial/" /><link rel="prev" href="http://example.org/posts/linux-space-release/" /><link rel="next" href="http://example.org/posts/postgresql_source/" />
<link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/color.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "docker 使用方法",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/example.org\/posts\/docker-tutorial\/"
        },"genre": "posts","keywords": "Linux, docker","wordcount":  2441 ,
        "url": "http:\/\/example.org\/posts\/docker-tutorial\/","datePublished": "2023-12-16T18:21:19+00:00","dateModified": "2023-12-16T18:21:19+00:00","publisher": {
            "@type": "Organization",
            "name": "z2z63"},"author": {
                "@type": "Person",
                "name": "z2z63"
            },"description": ""
    }
    </script><script src="//instant.page/5.2.0" defer type="module" integrity="sha384-jnZyxPjiipYXnSU0ygqeac2q7CVYMbh84q0uHVRRxEtvFPiQYbXWUorga2aqZJ0z"></script>
</head>

<body header-desktop="" header-mobile=""><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark'); window.theme = theme;   window.isDark = window.theme !== 'light' }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('' === 'light' || '' === 'dark' || '' === 'black') setTheme(''), saveTheme(''); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Virtualfutre&#39;s Blog">Virtualfutre&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Virtualfutre&#39;s Blog">Virtualfutre&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">Contents</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#docker架构">docker架构</a></li>
    <li><a href="#image与container">image与container</a></li>
    <li><a href="#docker的进程模型">docker的进程模型</a></li>
  </ul>

  <ul>
    <li><a href="#工作流1使用docker-hub提供的镜像">工作流1——使用docker hub提供的镜像</a>
      <ul>
        <li><a href="#启动容器">启动容器</a></li>
        <li><a href="#查看容器状态">查看容器状态</a></li>
        <li><a href="#交互式操作">交互式操作</a></li>
        <li><a href="#exec">exec</a></li>
        <li><a href="#attach">attach</a></li>
        <li><a href="#管理容器">管理容器</a></li>
      </ul>
    </li>
    <li><a href="#工作流2通过镜像协同工作">工作流2——通过镜像协同工作</a>
      <ul>
        <li><a href="#创建镜像">创建镜像</a></li>
        <li><a href="#分享给其他人">分享给其他人</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#数据持久化">数据持久化</a>
      <ul>
        <li><a href="#volume">volume</a></li>
        <li><a href="#bind">bind</a></li>
      </ul>
    </li>
    <li><a href="#dokcer的网络">dokcer的网络</a>
      <ul>
        <li><a href="#端口映射">端口映射</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#关于参数">关于参数</a></li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">docker 使用方法</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class="author fas fa-user-circle fa-fw"></span><a href="/" title="Author" rel=" author" class="author">z2z63</a>
                </span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2023-12-16">2023-12-16</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="2023-12-16">2023-12-16</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;2441 words&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;5 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#docker架构">docker架构</a></li>
    <li><a href="#image与container">image与container</a></li>
    <li><a href="#docker的进程模型">docker的进程模型</a></li>
  </ul>

  <ul>
    <li><a href="#工作流1使用docker-hub提供的镜像">工作流1——使用docker hub提供的镜像</a>
      <ul>
        <li><a href="#启动容器">启动容器</a></li>
        <li><a href="#查看容器状态">查看容器状态</a></li>
        <li><a href="#交互式操作">交互式操作</a></li>
        <li><a href="#exec">exec</a></li>
        <li><a href="#attach">attach</a></li>
        <li><a href="#管理容器">管理容器</a></li>
      </ul>
    </li>
    <li><a href="#工作流2通过镜像协同工作">工作流2——通过镜像协同工作</a>
      <ul>
        <li><a href="#创建镜像">创建镜像</a></li>
        <li><a href="#分享给其他人">分享给其他人</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#数据持久化">数据持久化</a>
      <ul>
        <li><a href="#volume">volume</a></li>
        <li><a href="#bind">bind</a></li>
      </ul>
    </li>
    <li><a href="#dokcer的网络">dokcer的网络</a>
      <ul>
        <li><a href="#端口映射">端口映射</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#关于参数">关于参数</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>这篇文章是完成docker的get started guide后的总结，见<a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/get-started/</a></p>
<h1 id="前置概念" class="headerLink">
    <a href="#%e5%89%8d%e7%bd%ae%e6%a6%82%e5%bf%b5" class="header-mark"></a>前置概念</h1><h2 id="docker架构" class="headerLink">
    <a href="#docker%e6%9e%b6%e6%9e%84" class="header-mark"></a>docker架构</h2><p>docker采用server-client架构，docker deamon（即dockerd）完成构建容器，运行容器等工作，docker client与docker deamon通过REST API或UNIX socket或网卡通信<br>
docker client可以是</p>
<ul>
<li>名为<code>docker</code>的cli（命令行接口）</li>
<li>docker compose(也是cli)</li>
<li>docker desktop（GUI）</li>
<li>etc&hellip;</li>
</ul>
<h2 id="image与container" class="headerLink">
    <a href="#image%e4%b8%8econtainer" class="header-mark"></a>image与container</h2><p>image和container的关系类似于类与对象，image可以从docker hub中下载，container是一个image的实例</p>
<h2 id="docker的进程模型" class="headerLink">
    <a href="#docker%e7%9a%84%e8%bf%9b%e7%a8%8b%e6%a8%a1%e5%9e%8b" class="header-mark"></a>docker的进程模型</h2><p>在启动容器时，会提供一个命令用于启动主进程，docker的默认一个容器只做一件事而且做到最好，所以一个容器一般只运行一个进程，docker的进程调度器也对此做过针对优化<br>
主进程退出时，docker也会自动停止镜像</p>
<h1 id="安装" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85" class="header-mark"></a>安装</h1><p>首先用包管理器安装docker</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo pacma -S docker
</span></span></code></pre></div><p>然后启动dockerd</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> docker
</span></span><span class="line"><span class="cl">sudo systemctl start docker
</span></span></code></pre></div><p>可能出现非root用户无法运行dokcer的情况，可以将当前用户加入docker用户组<br>
注意这实际上是不够安全的，可能会增加一个攻击面</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo gpasswd -a <span class="si">${</span><span class="nv">USER</span><span class="si">}</span> docker
</span></span></code></pre></div><h1 id="使用" class="headerLink">
    <a href="#%e4%bd%bf%e7%94%a8" class="header-mark"></a>使用</h1><p>docker有许多子命令，可以输入<code>docker --help</code>查询所有子命令<br>
子命令也可以通过<code>--help</code>参数查询使用方法，例如<code>docker image --help</code></p>
<h2 id="工作流1使用docker-hub提供的镜像" class="headerLink">
    <a href="#%e5%b7%a5%e4%bd%9c%e6%b5%811%e4%bd%bf%e7%94%a8docker-hub%e6%8f%90%e4%be%9b%e7%9a%84%e9%95%9c%e5%83%8f" class="header-mark"></a>工作流1——使用docker hub提供的镜像</h2><h3 id="启动容器" class="headerLink">
    <a href="#%e5%90%af%e5%8a%a8%e5%ae%b9%e5%99%a8" class="header-mark"></a>启动容器</h3><p>以ubuntu镜像为例<br>
拉取一个镜像到本地</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker pull ubuntu
</span></span></code></pre></div><p>创建一个ubuntu的容器</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker create ubuntu
</span></span></code></pre></div><p>docker会随机给这个容器随机生成一个名字，也可以指定名字</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker create --name mycontainer ubuntu
</span></span></code></pre></div><p>创建后，启动容器</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker start mycontainer
</span></span></code></pre></div><hr>
<p>docker提供了一个更简单的命令<code>run</code>来简化这个流程</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run ubuntu <span class="c1"># 同样可以通过--name指定容器名</span>
</span></span></code></pre></div><p><code>run</code>命令会自动拉取镜像（如果本地没有），创建容器，启动容器</p>
<h3 id="查看容器状态" class="headerLink">
    <a href="#%e6%9f%a5%e7%9c%8b%e5%ae%b9%e5%99%a8%e7%8a%b6%e6%80%81" class="header-mark"></a>查看容器状态</h3><p>启动ubutnu容器后，可以通过<code>ps</code>查看容器状态</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker ps
</span></span></code></pre></div><p>然而发现并没有结果，这是因为<code>ps</code>只输出运行中的容器<br>
查看全部容器</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker ps -a
</span></span></code></pre></div><p>发现刚刚启动的容器的状态是<code>Exited</code>，这是dokcer的进程模型导致的，因为ubuntu容器的启动命令是<code>/bin/bash</code>，bash默认读取标准输入，而没有提供标准输入，所以bash读取到<code>EOF</code>后退出，主进程退出后容器也自动停止了</p>
<h3 id="交互式操作" class="headerLink">
    <a href="#%e4%ba%a4%e4%ba%92%e5%bc%8f%e6%93%8d%e4%bd%9c" class="header-mark"></a>交互式操作</h3><p>前文提及，因为没有提供标准输入，ubutnu镜像立刻退出了，为了避免这种情况，或能够进入ubutnu容器的终端，可以提供标准输入</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -it ubuntu
</span></span></code></pre></div><p>进入ubuntu容器的终端后，按下Ctrl+D，bash退出，ubutnu容器也会被停止<br>
<code>-it</code>参数中，<code>-i</code>表示即使没有连接到标准输入也不关闭，<code>-t</code>表示分配一个tty，有了<code>-t</code>，就能将当前终端连接到容器内bash的标准输入、标准输出、标准错误，有了<code>-i</code>，就能在退出容器后（标准输入deattach）后，再次启动（<code>start</code>命令）ubuntu容器后，容器不立刻退出（因为标准输入没有关闭，不会读取到EOF，只是在<code>read</code>系统调用上阻塞）</p>
<h3 id="exec" class="headerLink">
    <a href="#exec" class="header-mark"></a>exec</h3><p>exec命令可以在一个<strong>运行中</strong>的容器内执行命令<br>
先创造出一个运行中的ubutnu容器</p>
<pre tabindex="0"><code>docker run -it --name mycontainer ubuntu
# 在容器的bash中按下Ctrl+D或exit
docker start mycontainer
</code></pre><p>再使用<code>exec</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it mycontainer bash
</span></span></code></pre></div><p>又进入了bash，然而这个bash实际上是新开的bash进程，在容器内输入<code>top</code>，可以看到有两个bash，其中一个是通过<code>run</code>创建的，另一个是通过<code>exec</code>创建的</p>
<h3 id="attach" class="headerLink">
    <a href="#attach" class="header-mark"></a>attach</h3><p>如上，为了避免再创建一个bash进程，可以将当前终端的标准输入，标准输出，标准错误连接到容器内</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker attach mycontainer
</span></span></code></pre></div><p>在容器内执行<code>top</code>，发现只有一个bash进程</p>
<h3 id="管理容器" class="headerLink">
    <a href="#%e7%ae%a1%e7%90%86%e5%ae%b9%e5%99%a8" class="header-mark"></a>管理容器</h3><p>停止容器</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker stop mycontainer
</span></span></code></pre></div><p>删除容器</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker rm mycontainer
</span></span></code></pre></div><h2 id="工作流2通过镜像协同工作" class="headerLink">
    <a href="#%e5%b7%a5%e4%bd%9c%e6%b5%812%e9%80%9a%e8%bf%87%e9%95%9c%e5%83%8f%e5%8d%8f%e5%90%8c%e5%b7%a5%e4%bd%9c" class="header-mark"></a>工作流2——通过镜像协同工作</h2><p>创建一个镜像后，可以分享给其他人，从而解决环境搭建、统一环境等问题</p>
<h3 id="创建镜像" class="headerLink">
    <a href="#%e5%88%9b%e5%bb%ba%e9%95%9c%e5%83%8f" class="header-mark"></a>创建镜像</h3><p>一个Dockerfile的示例</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> node:18-alpine</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /app</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> . .<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yarn install --production<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;node&#34;</span><span class="p">,</span> <span class="s2">&#34;src/index.js&#34;</span><span class="p">]</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 3000</span><span class="err">
</span></span></span></code></pre></div><p>随后通过当前目录下的<code>Dockerfile</code>的内容创建镜像</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker build -t myimage
</span></span></code></pre></div><h3 id="分享给其他人" class="headerLink">
    <a href="#%e5%88%86%e4%ba%ab%e7%bb%99%e5%85%b6%e4%bb%96%e4%ba%ba" class="header-mark"></a>分享给其他人</h3><h4 id="使用docker-hub" class="headerLink">
    <a href="#%e4%bd%bf%e7%94%a8docker-hub" class="header-mark"></a>使用docker hub</h4><p>在docker hub注册帐号，然后将镜像上传置docker hub</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker push &lt;myname&gt;/&lt;myimage&gt;
</span></span></code></pre></div><p>其他人可以得到你创建的容器</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker pull &lt;myname&gt;/&lt;myimage&gt;
</span></span></code></pre></div><p>或</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run &lt;myname&gt;/&lt;myimage&gt;
</span></span></code></pre></div><h4 id="发送镜像文件" class="headerLink">
    <a href="#%e5%8f%91%e9%80%81%e9%95%9c%e5%83%8f%e6%96%87%e4%bb%b6" class="header-mark"></a>发送镜像文件</h4><p>导出镜像到文件</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker save -o path/to/image_file.tar myimage
</span></span></code></pre></div><p>随后将文件发送给其他人，其他人执行</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker load -i path/to/image_file.tar
</span></span></code></pre></div><p>即可得到镜像</p>
<h4 id="第三方镜像托管服务" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%89%e6%96%b9%e9%95%9c%e5%83%8f%e6%89%98%e7%ae%a1%e6%9c%8d%e5%8a%a1" class="header-mark"></a>第三方镜像托管服务</h4><p>本质和docker hub相同，不过docker hub在国内被墙，而且不同的服务商的商业策略不同，dokcer hub属于典型的freemium模式，即大部分用户免费使用基础功能，小部分用户为高级功能付费。如果使用dokcer开发，可能会遇到不得不向dokcer hub支付的情况。<br>
此外，dokcer hub最流行的原因还是因为它是官方的镜像托管服务，生态最好</p>
<h4 id="私有镜像仓库" class="headerLink">
    <a href="#%e7%a7%81%e6%9c%89%e9%95%9c%e5%83%8f%e4%bb%93%e5%ba%93" class="header-mark"></a>私有镜像仓库</h4><p>可以使用开源self-host方案自建私有仓库，不再受dokcer hub的限制，不过也要考虑自建的成本<br>
这应该是企业常用的解决方案</p>
<h1 id="docker的其他功能" class="headerLink">
    <a href="#docker%e7%9a%84%e5%85%b6%e4%bb%96%e5%8a%9f%e8%83%bd" class="header-mark"></a>docker的其他功能</h1><h2 id="数据持久化" class="headerLink">
    <a href="#%e6%95%b0%e6%8d%ae%e6%8c%81%e4%b9%85%e5%8c%96" class="header-mark"></a>数据持久化</h2><h3 id="volume" class="headerLink">
    <a href="#volume" class="header-mark"></a>volume</h3><h3 id="bind" class="headerLink">
    <a href="#bind" class="header-mark"></a>bind</h3><h2 id="dokcer的网络" class="headerLink">
    <a href="#dokcer%e7%9a%84%e7%bd%91%e7%bb%9c" class="header-mark"></a>dokcer的网络</h2><h3 id="端口映射" class="headerLink">
    <a href="#%e7%ab%af%e5%8f%a3%e6%98%a0%e5%b0%84" class="header-mark"></a>端口映射</h3><h1 id="docker-compose" class="headerLink">
    <a href="#docker-compose" class="header-mark"></a>docker compose</h1><p>假设需要搭建一个前后端分离的web服务，前端页面由机器上已经安装好的nginx分发，后端服务使用docker部署，此外还需要一个mysql容器提供数据库服务。这需要多个容器协作。前文提到，一个容器只做一件事并做到最好，当需要多个容器协作时，使用docker-cli管理的难度就变大了，docker compose就是为了解决这种问题而出现的<br>
docker compose需要额外安装</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo pacman -S docker-compose
</span></span></code></pre></div><p>dokcer compose使用compose.yaml文件描述每个容器的配置以及他们之间的依赖关系等等
一个compose.yaml实例</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">app</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">node:18-alpine</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">sh -c &#34;yarn install &amp;&amp; yarn run dev&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">127.0.0.1</span><span class="p">:</span><span class="m">3000</span><span class="p">:</span><span class="m">3000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">working_dir</span><span class="p">:</span><span class="w"> </span><span class="l">/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./:/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MYSQL_HOST</span><span class="p">:</span><span class="w"> </span><span class="l">mysql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l">secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MYSQL_DB</span><span class="p">:</span><span class="w"> </span><span class="l">todos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">mysql</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">mysql:8.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">todo-mysql-data:/var/lib/mysql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MYSQL_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l">secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="l">todos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">todo-mysql-data</span><span class="p">:</span><span class="w">
</span></span></span></code></pre></div><h1 id="一点技巧" class="headerLink">
    <a href="#%e4%b8%80%e7%82%b9%e6%8a%80%e5%b7%a7" class="header-mark"></a>一点技巧</h1><h2 id="关于参数" class="headerLink">
    <a href="#%e5%85%b3%e4%ba%8e%e5%8f%82%e6%95%b0" class="header-mark"></a>关于参数</h2><p>不同的命令行工具都有不同的传参风格，其中<code>docker</code>的参数只能在固定位置，例如<code>dokcer run -it ubuntu</code>的<code>-it</code>不能放到<code>ubuntu</code>后面</p></div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-12-16</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share"></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/linux/">Linux</a>,&nbsp;<a href="/tags/docker/">Docker</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/linux-space-release/" class="prev" rel="prev" title="Linux释放磁盘空间"><i class="fas fa-angle-left fa-fw"></i>Linux释放磁盘空间</a>
            <a href="/posts/postgresql_source/" class="next" rel="next" title="PostgreSQL源码阅读报告">PostgreSQL源码阅读报告<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.123.8">Hugo</a>&nbsp;|&nbsp;Theme - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreferrer" title="DoIt 0.4.0"><i class="far fa-edit fa-fw"></i> DoIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank" rel="noopener noreferrer"></a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="Back to Top">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><link rel="stylesheet" href="/lib/gitalk/gitalk.min.css"><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{"gitalk":{"admin":["z2z63"],"clientID":"7156e4335b80dc5f38c0","clientSecret":"f6118f46792df390e800c05b52300a8da0114474","id":"2023-12-16T18:21:19Z","owner":"z2z63","repo":"z2z63.github.io","title":"docker 使用方法"}}};</script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/js/theme.min.js" defer></script><script type="text/javascript" src="/lib/gitalk/gitalk.min.js"></script><script type="text/javascript" src="/js/gitalk.min.js" defer></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-48XH0QHHK3');
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-48XH0QHHK3" async></script></div>
</body>

</html>